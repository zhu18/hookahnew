<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jusfoun.hookah.core.dao.PayAccountMapper" >
  <!--<resultMap id="BaseResultMap" type="com.jusfoun.hookah.core.domain.PayAccount" >-->
    <!--&lt;!&ndash;-->
      <!--WARNING - @mbggenerated-->
      <!--This element is automatically generated by MyBatis Generator, do not modify.-->
    <!--&ndash;&gt;-->
    <!--<id column="id" property="id" jdbcType="BIGINT" />-->
    <!--<result column="user_id" property="userId" jdbcType="VARCHAR" />-->
    <!--<result column="balance" property="balance" jdbcType="BIGINT" />-->
    <!--<result column="use_balance" property="useBalance" jdbcType="BIGINT" />-->
    <!--<result column="frozen_balance" property="frozenBalance" jdbcType="BIGINT" />-->
    <!--<result column="pay_password" property="payPassword" jdbcType="VARCHAR" />-->
    <!--<result column="account_flag" property="accountFlag" jdbcType="TINYINT" />-->
    <!--<result column="merchant_id" property="merchantId" jdbcType="VARCHAR" />-->
    <!--<result column="add_time" property="addTime" jdbcType="TIMESTAMP" />-->
    <!--<result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />-->
    <!--<result column="add_operator" property="addOperator" jdbcType="VARCHAR" />-->
    <!--<result column="update_operator" property="updateOperator" jdbcType="VARCHAR" />-->
  <!--</resultMap>-->
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, user_id, balance, use_balance, frozen_balance, pay_password, account_flag, merchant_id, 
    add_time, update_time, add_operator, update_operator
  </sql>

  <insert id="insertAndGetId" useGeneratedKeys="true" keyProperty="id" parameterType="com.jusfoun.hookah.core.domain.PayAccount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into pay_account (user_id,user_name,balance,
    use_balance, frozen_balance, pay_password,
    account_flag, merchant_id, add_time,
    update_time, add_operator, update_operator,
    ending_balance, account_type
    )
    values (#{userId,jdbcType=VARCHAR},#{userName,jdbcType=VARCHAR}, #{balance,jdbcType=BIGINT},
    #{useBalance,jdbcType=BIGINT}, #{frozenBalance,jdbcType=BIGINT}, #{payPassword,jdbcType=VARCHAR},
    #{accountFlag,jdbcType=TINYINT}, #{merchantId,jdbcType=VARCHAR}, #{addTime,jdbcType=TIMESTAMP},
    #{updateTime,jdbcType=TIMESTAMP}, #{addOperator,jdbcType=VARCHAR}, #{updateOperator,jdbcType=VARCHAR},
    #{endingBalance,jdbcType=BIGINT}, #{accountType,jdbcType=VARCHAR}
    )
  </insert>

  <update id="OperatorByType" parameterType="java.util.HashMap">

    update pay_account set
      <if test="type == 'plus'">
        balance = balance + #{changeMoney},
        use_balance = use_balance + #{changeMoney}
      </if>
      <if test="type == 'sub'">
        balance = balance - #{changeMoney},
        use_balance = use_balance - #{changeMoney}
      </if>
      <if test="type == 'FreezaIn'">
        balance = balance + #{changeMoney},
        frozen_balance = frozen_balance + #{changeMoney}
      </if>
      <if test="type == 'releaseDraw'">
        use_balance = use_balance + #{changeMoney},
        frozen_balance = frozen_balance - #{changeMoney}
      </if>
      <if test="type == 'SettleCut'">
        balance = balance - #{changeMoney},
        frozen_balance = frozen_balance - #{changeMoney}
      </if>
    where id = #{id}

  </update>


  <update id="updatePayAccountMoney" parameterType="java.util.HashMap">

    update pay_account set balance = balance + #{money},use_balance = use_balance + #{money},
    update_time = now(),update_operator = #{userId}
    where id = #{payAccountId}

  </update>


</mapper>