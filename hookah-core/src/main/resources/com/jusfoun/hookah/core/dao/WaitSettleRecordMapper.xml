<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jusfoun.hookah.core.dao.WaitSettleRecordMapper" >
  <!--<resultMap id="BaseResultMap" type="com.jusfoun.hookah.core.domain.WaitSettleRecord" >-->
    <!--&lt;!&ndash;-->
      <!--WARNING - @mbggenerated-->
      <!--This element is automatically generated by MyBatis Generator, do not modify.-->
    <!--&ndash;&gt;-->
    <!--<id column="id" property="id" jdbcType="BIGINT" />-->
    <!--<result column="shopName" property="shopname" jdbcType="VARCHAR" />-->
    <!--<result column="order_sn" property="orderSn" jdbcType="VARCHAR" />-->
    <!--<result column="goods_id" property="goodsId" jdbcType="INTEGER" />-->
    <!--<result column="order_id" property="orderId" jdbcType="VARCHAR" />-->
    <!--<result column="order_amount" property="orderAmount" jdbcType="BIGINT" />-->
    <!--<result column="settle_status" property="settleStatus" jdbcType="VARCHAR" />-->
    <!--<result column="has_settle_amount" property="hasSettleAmount" jdbcType="VARCHAR" />-->
    <!--<result column="no_settle_amount" property="noSettleAmount" jdbcType="VARCHAR" />-->
    <!--<result column="order_time" property="orderTime" jdbcType="TIMESTAMP" />-->
    <!--<result column="add_time" property="addTime" jdbcType="TIMESTAMP" />-->
    <!--<result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />-->
  <!--</resultMap>-->
  <!--<sql id="Base_Column_List" >-->
    <!--&lt;!&ndash;-->
      <!--WARNING - @mbggenerated-->
      <!--This element is automatically generated by MyBatis Generator, do not modify.-->
    <!--&ndash;&gt;-->
    <!--id, shopName, order_sn, goods_id, order_id, order_amount, settle_status, has_settle_amount, -->
    <!--no_settle_amount, order_time, add_time, update_time-->
  <!--</sql>-->


  <insert id="insertAndGetId" useGeneratedKeys="true" keyProperty="id" parameterType="com.jusfoun.hookah.core.domain.WaitSettleRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into wait_settle_record (goods_name, shop_name, order_sn,
      goods_id, order_id, order_amount, 
      settle_status, has_settle_amount, no_settle_amount, 
      order_time, add_time, update_time
      )
    values (#{goodsName,jdbcType=VARCHAR}, #{shopName,jdbcType=VARCHAR}, #{orderSn,jdbcType=VARCHAR},
      #{goodsId,jdbcType=INTEGER}, #{orderId,jdbcType=VARCHAR}, #{orderAmount,jdbcType=BIGINT}, 
      #{settleStatus,jdbcType=VARCHAR}, #{hasSettleAmount,jdbcType=VARCHAR}, #{noSettleAmount,jdbcType=VARCHAR}, 
      #{orderTime,jdbcType=TIMESTAMP}, #{addTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP}
      )
  </insert>

  <update id="settleOperator">

      update wait_settle_record
        SET
        has_settle_amount = has_settle_amount + #{settleAmount},
        no_settle_amount = no_settle_amount - #{settleAmount}
        where id = #{id}
  </update>

  <insert id="insertBatch" parameterType="java.util.List">
    insert into wait_settle_record
      (
        goods_name, shop_name, order_sn,
        goods_id, order_id, order_amount,
        settle_status, has_settle_amount, no_settle_amount,
        order_time, add_time, update_time
      )
      values
      <foreach collection="list" index="index" item="item" separator=",">
      (
        #{item.goodsName,jdbcType=VARCHAR}, #{item.shopName,jdbcType=VARCHAR}, #{item.orderSn,jdbcType=VARCHAR},
        #{item.goodsId,jdbcType=INTEGER}, #{item.orderId,jdbcType=VARCHAR}, #{item.orderAmount,jdbcType=BIGINT},
        #{item.settleStatus,jdbcType=VARCHAR}, #{item.hasSettleAmount,jdbcType=VARCHAR}, #{item.noSettleAmount,jdbcType=VARCHAR},
        #{item.orderTime,jdbcType=TIMESTAMP}, #{item.addTime,jdbcType=TIMESTAMP}, #{item.updateTime,jdbcType=TIMESTAMP}
      )
      </foreach>
  </insert>

  <select id="getListForPage" resultType="com.jusfoun.hookah.core.domain.vo.WaitSettleRecordVo">

      SELECT
        wsr.id AS id,
        wsr.order_sn AS orderSn,
        wsr.goods_name AS goodsName,
        goods.goods_img AS goodsImg,
        goods.goods_sn AS goodsSn,
        org.org_name AS orgName,
        wsr.order_amount AS orderAmount,
        wsr.has_settle_amount AS hasSettleAmount,
        wsr.no_settle_amount AS noSettleAmount,
        wsr.settle_status AS settleStatus,
        wsr.order_time AS orderTime
      FROM wait_settle_record wsr
      LEFT JOIN goods goods ON wsr.goods_id = goods.goods_id
      LEFT JOIN `user` us ON wsr.shop_name = us.user_id
      LEFT JOIN organization org ON org.org_id = us.org_id
      WHERE 1 = 1
      <if test="startDate != '' and startDate != null">
        AND wsr.order_time &gt;= #{startDate}
      </if>
      <if test="endDate != '' and endDate != null">
        AND wsr.order_time &lt;= #{endDate}
      </if>
      <if test="shopName != '' and shopName != null">
        AND org.org_name like '%${shopName}%'
      </if>
      <if test="settleStatus != null">
        AND wsr.settle_status = #{settleStatus}
      </if>
      <if test="orderSn != '' and orderSn != null">
        AND wsr.order_sn = #{orderSn}
      </if>
      ORDER BY wsr.order_time DESC
  </select>

  <select id="selectDetailById" resultType="com.jusfoun.hookah.core.domain.vo.WaitSettleRecordVo">

      SELECT
        wsr.id AS id,
        wsr.order_sn AS orderSn,
        wsr.goods_name AS goodsName,
        goods.goods_img AS goodsImg,
        goods.goods_sn AS goodsSn,
        org.org_name AS orgName,
        wsr.order_amount AS orderAmount,
        wsr.has_settle_amount AS hasSettleAmount,
        wsr.no_settle_amount AS noSettleAmount,
        wsr.settle_status AS settleStatus,
        wsr.order_time AS orderTime
      FROM wait_settle_record wsr
      LEFT JOIN goods goods ON wsr.goods_id = goods.goods_id
      LEFT JOIN `user` us ON wsr.shop_name = us.user_id
      LEFT JOIN organization org ON org.org_id = us.org_id
      WHERE wsr.id = #{id}
  </select>

</mapper>