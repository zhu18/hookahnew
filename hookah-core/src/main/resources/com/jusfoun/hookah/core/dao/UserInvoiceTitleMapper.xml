<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jusfoun.hookah.core.dao.UserInvoiceTitleMapper" >

    <resultMap id="UserInvoiceTitleVoResultMap" type="com.jusfoun.hookah.core.domain.vo.UserInvoiceTitleVo">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="title_id" property="titleId" jdbcType="VARCHAR" />
        <result column="user_invoice_type" property="userInvoiceType" jdbcType="TINYINT" />
        <result column="user_id" property="userId" jdbcType="VARCHAR" />
        <result column="title_name" property="titleName" jdbcType="VARCHAR" />
        <result column="taxpayer_identify_no" property="taxpayerIdentifyNo" jdbcType="VARCHAR" />
        <result column="reg_address" property="regAddress" jdbcType="VARCHAR" />
        <result column="reg_tel" property="regTel" jdbcType="VARCHAR" />
        <result column="reg_time" property="regTime" jdbcType="TIMESTAMP" />
        <result column="open_bank" property="openBank" jdbcType="VARCHAR" />
        <result column="bank_account" property="bankAccount" jdbcType="VARCHAR" />
        <result column="default_status" property="defaultStatus" jdbcType="TINYINT" />
        <result column="invoice_status" property="invoiceStatus" jdbcType="TINYINT" />
        <result column="add_time" property="addTime" jdbcType="TIMESTAMP" />
        <result column="version" property="version" jdbcType="INTEGER" />

        <result column="user_type" jdbcType="TINYINT" property="userType" />
        <result column="user_name" jdbcType="VARCHAR" property="userName" />
        <result column="real_name" jdbcType="VARCHAR" property="realName" />

    </resultMap>

    <select id="getIncreInvoiceList2" resultMap="UserInvoiceTitleVoResultMap">

        SELECT
        ut.*, u.user_name,
        u.user_type,
        ud.real_name
        FROM
        (
        select uti.* from user_invoice_title  uti,(select * from user usee where usee.user_type = 2) us
        where uti.user_id = us.user_id and uti.user_invoice_type = 1) ut

        LEFT JOIN user u on ut.user_id = u.user_id

        LEFT JOIN user_detail ud on u.user_id = ud.user_id

        WHERE 1=1

        <if test="userName != null ">
            AND u.user_name LIKE '%${userName}%'
        </if>
        <if test="invoiceStatus != -1 ">
            AND ut.invoice_status = #{invoiceStatus,jdbcType=TINYINT}
        </if>
    </select>

    <select id="getIncreInvoiceList4" resultMap="UserInvoiceTitleVoResultMap">

        SELECT
        ut.*,
        u.user_name,
        u.user_type,
        org.org_name as real_name
        FROM
        (
        select uti.* from user_invoice_title  uti,(select * from user usee where usee.user_type = 4) us
        where uti.user_id = us.user_id and uti.user_invoice_type = 1) ut

        LEFT JOIN user u on ut.user_id = u.user_id

        LEFT JOIN organization org on u.org_id = org.org_id

        WHERE 1=1

        <if test="userName != null ">
            AND u.user_name LIKE '%${userName}%'
        </if>
        <if test="invoiceStatus != -1 ">
            AND ut.invoice_status = #{invoiceStatus,jdbcType=TINYINT}
        </if>
    </select>

    <select id="findUserInvoiceTitleInfo2" resultMap="UserInvoiceTitleVoResultMap">

        SELECT
        ut.*,
        u.user_name,
        u.user_type,
        ud.real_name
        FROM
        user_invoice_title ut
        LEFT JOIN user u on ut.user_id = u.user_id
	    LEFT JOIN user_detail ud on u.user_id = ud.user_id
        WHERE
        ut.user_invoice_type = 1
        AND ut.title_id = #{titleId,jdbcType=VARCHAR}

    </select>

    <select id="findUserInvoiceTitleInfo4" resultMap="UserInvoiceTitleVoResultMap">

        SELECT
        ut.*,
        u.user_name,
        u.user_type,
        org.org_name as real_name
        FROM
        user_invoice_title ut
        LEFT JOIN user u on ut.user_id = u.user_id
        LEFT JOIN organization org ON u.org_id = org.org_id
        WHERE
        ut.user_invoice_type = 1
        AND ut.title_id = #{titleId,jdbcType=VARCHAR}

    </select>
</mapper>