# 交易系统部门 

###前端编码规范

***

**黄金定律**

> 永远遵循同一套编码规范 -- 这样可以让一个团队办事效率更高，不管有多少人共同参与同一项目，确保每一行代码都像是同一个人编写的。


目录

| 一、HTML |
| --- |
| 1.1 语法 |
| 1.2 HTML5 doctype |
| 1.3 语言属性（Language attribute） |
| 1.4 字符编码 |
| 1.5 IE 兼容模式 |
| 1.6 引入 CSS 和 JavaScript 文件 |
| 1.7 实用为王 |
| 1.8 属性顺序 |
| 1.9 布尔（boolean）型属性 |
| 1.10 减少标签的数量 |
| 1.11 JavaScript 生成的标签 |
| 1.12 语义化 |

| 二、CSS |
| --- |
| 2.1 语法 |
| 2.2 声明顺序 |
| 2.3 不要使用@import |
| 2.4 媒体查询（Media query）的位置 |
| 2.5 带前缀的属性 |
| 2.6 单行规则声明 |
| 2.7 简写形式的属性声明 |
| 2.8 Less 和 Sass 中的嵌套 |
| 2.9 注释 |
| 2.10 编辑器配置 |
| 2.11 文件/资源命名 |
| 2.12 class 命名 |
| 2.13 代码组织 |
| 2.14 命名规范 |

| 三、Javascript |
| --- |
| 3.1 JavaScript 语言规范 |
| 3.1.1 文件编码 |
| 3.1.2 使用严格模式 |
| 3.1.3 避免使用全局标量 |
| 3.1.4 语句的结尾总是使用分号 |
| 3.1.5 变量使用前必须使用var 声明 |
| 3.1.6 块内函数声明 |
| 3.1.7 异常 |
| 3.1.8 自定义异常 |
| 3.1.9 标准特性总是由于非标准特性 |
| 3.1.10 不要封装基本类型 |
| 3.1.11 this |
| 3.1.12 不要在 Array 上使用 for-in 循环 |
| 3.1.13 不要使用关联数组 |
| 3.1.14 用 Array 和 Object 字面量代替 Array 和 Object 构造函数 |
| 3.1.15 类方法的定义 |
| 3.1.16 禁止修改内置对象的原型 |
| 3.1.17 闭包 |
| 3.1.18 eval() |
| 3.1.19 不要使用 with() {}语句 |
| 3.1.20 不要给 setInterval / setTimeOut 传递| 
| 3.1.21 拼接字符串 |
| 3.2 JavaScript 编码风格 |
| 3.2.1 命名方式 |
| 3.2.2 变量延迟初始化 |
| 3.2.3 明确作用域 |
| 3.2.4 代码格式 |
| 3.2.5 花括号 |
| 3.2.6 数组和对象的初始化 |
| 3.2.7 函数参数 |
| 3.2.8 空行 |
| 3.2.9 二元和三元操作符 |
| 3.2.10 空格 |
| 3.2.11 逗号位置 |
| 3.2.12 圆括号 |
| 3.2.13 字符串 |
| 3.2.14 对象 |


# 一.HTML

## 1.1 语法

- 用四个空格来代替制表符（tab） -- 这是唯一能保证在所有环境下获得一致展现的方法。
- 嵌套元素应当缩进一次（即四个空格）。
- 对于属性的定义，属性必须加引号，确保全部使用双引号，绝不要使用单引号，
- 不要在自闭合（self-closing）元素的尾部添加斜线 -- [HTML5 规范](http://dev.w3.org/html5/spec-author-view/syntax.html#syntax-start-tag)中明确说明这是可选的。
- 不要省略可选的结束标签（closing tag）（例如，&lt;/li&gt;或&lt;/body&gt;）。

```html
<!DOCTYPE html>
<html>
  <head>
    <title>Page title</title>
  </head>
  <body>
    <img src="images/company-logo.png" alt="Company">
    <h1 class="hello-world">Hello, world!</h1>
  </body>
</html>
```

## 1.2 HTML5 doctype

- 为每个 HTML 页面的第一行添加标准模式（standard mode）的声明，这样能够确保在每个浏览器中拥有一致的展现。

```html
<!DOCTYPE html>
<html>
  <head>
  </head>
</html>
```

## 1.3 语言属性（Language attribute）

- 根据 HTML5 规范：强烈建议为 html 根元素指定 lang 属性，从而为文档设置正确的语言。这将有助于语音合成工具确定其所应该采用的发音，有助于翻译工具确定其翻译时所应遵守的规则等等。

```html
<html lang="zh-CN">
  <!-- ... -->
</html>
```

## 1.4 字符编码

- 明确声明字符编码，能够确保浏览器快速并容易的判断页面内容的渲染方式。这样做的好处是，可以避免在 HTML 中使用字符实体标记（character entity），从而全部与文档编码一致（一般采用 UTF-8 编码）。

```html
<head>
  <meta charset="UTF-8">
</head>
```

## 1.5 IE 兼容模式

- IE 支持通过特定的 &lt;meta&gt; 标签来确定绘制当前页面所应该采用的 IE 版本。除非有强烈的特殊需求，否则最好是设置为 edge mode，从而通知 IE 采用其所支持的最新的模式。

```html
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
```

## 1.6 引入 CSS 和 JavaScript 文件

- 根据 HTML5 规范，在引入 CSS 和 JavaScript 文件时一般不需要指定type属性，但是我们还是保持这个属性

```html
<!-- External CSS -->
<link rel="stylesheet" href="code-guide.css"  type="text/css">

<!-- In-document CSS -->
<style type="text/css" >
  /* ... */
</style>
<!-- JavaScript -->
<script src="code-guide.js"  type="text/javascript"></script>
```

## 1.7 实用为王

- 尽量遵循 HTML 标准和语义，但是不要以牺牲实用性为代价。任何时候都要尽量使用最少的标签并保持最小的复杂度。

## 1.8 属性顺序

* HTML属性应当按照以下给出的顺序依次排列，确保代码的易读性。
 * class
 * id, name
 * data-\*
 * src, for, type, href
 * title, alt
 * aria-\*, role

>class 用于标识高度可复用组件，因此应该排在首位。id 用于标识具体组件，应当谨慎使用（例如，页面内的书签），因此排在第二位。

```html
<a class="..." id="..." data-modal="toggle" href="#">
  Example link
</a>
<input class="form-control" type="text">
<img src="..." alt="...">
```

## 1.9 布尔（boolean）型属性

- 元素的布尔型属性如果有值，就是 true，如果没有值，就是 false。简单来说，就是不用赋值，但是我们最好还是给他赋值

```html
<input type="text" disabled=" disabled ">
<input type="checkbox" value="1" checked="checked">
<select>
  <option value="1" selected="selected">1</option>
</select>
```

## 1.10 减少标签的数量

- 编写HTML 代码时，尽量避免多余的父元素。很多时候，这需要迭代和重构来实现。请看下面的案例：

```html
<!-- Not so great -->
<span class="avatar">
  <img src="...">
</span>

<!-- Better -->
<img class="avatar" src="...">
```

## 1.11 JavaScript 生成的标签

- 通过 JavaScript 生成的标签让内容变得不易查找、编辑，并且降低性能。能避免时尽量避免

## 1.12 语义化

- 根据元素（有时被错误地称作&quot;标签&quot;）其被创造出来时的初始意义来使用它。打个比方，用heading元素来定义头部标题，p 元素来定义文字段落，用 a 元素来定义链接锚点等等。

```html
//不推荐
<div class="top-navigation">
  	<div class="nav-item"><a href="#home">Home</a></div>
  	<div class="nav-item"><a href="#news">News</a></div>
 	<div class="nav-item"><a href="#about">About</a></div>
</div>

//推荐
<nav class="top-navigation">
  <!-- A listing of elements should always go to UL (OL for ordered listings) -->
  <ul>
    <li class="nav-item"><a href="#home">Home</a></li>
    <li class="nav-item"><a href="#news">News</a></li>
    <li class="nav-item"><a href="#about">About</a></li>
  </ul>
</nav>	
```

# 二.CSS

## 2.1 语法

- 用两个空格来代替制表符（tab） -- 这是唯一能保证在所有环境下获得一致展现的方法。
- 为选择器分组时，将单独的选择器单独放在一行。
- 为了代码的易读性，在每个声明块的左花括号前添加一个空格。
- 声明块的右花括号应当单独成行。
- 为了获得更准确的错误报告，每条声明都应该独占一行。
- 所有声明语句都应当以分号结尾。最后一条声明语句后面的分号是可选的，但是，如果省略这个分号，你的代码可能更易出错。
- 对于以逗号分隔的属性值，每个逗号后面都应该插入一个空格（例如，box-shadow）。
- 不要在rgb()、rgba()、hsl()、hsla()或rect()值的内部的逗号后面插入空格。这样利于从多个属性值（既加逗号也加空格）中区分多个颜色值（只加逗号，不加空格）。
- 对于属性值或颜色参数，省略小于 1 的小数前面的 0 （例如，.5代替0.5；-.5px代替-0.5px）。
- 十六进制值应该全部小写，例如，#fff。在扫描文档时，小写字符易于分辨，因为他们的形式更易于区分。
- 尽量使用简写形式的十六进制值，例如，用#fff代替#ffffff。
- 为选择器中的属性添加双引号，例如，input[type=&quot;text&quot;]。
- 避免为 0 值指定单位，例如，用margin: 0;代替margin: 0px;。

```css
/* Bad CSS */
.selector, .selector-secondary, .selector[type=text] {
  padding:15px;
  margin:0px 0px 15px;
  background-color:rgba(0, 0, 0, 0.5);
  box-shadow:0px 1px 2px #CCC,inset 0 1px 0 #FFFFFF
}

/* Good CSS */
.selector,
.selector-secondary,
.selector[type="text"] {
  padding: 15px;
  margin-bottom: 15px;
  background-color: rgba(0,0,0,.5);
  box-shadow: 0 1px 2px #ccc, inset 0 1px 0 #fff;
}
```

## 2.2 声明顺序

* 通相关的属性声明应当归为一组，并按照下面的顺序排列：
 *  Positioning（定位）
 *  Box model（盒模型）
 *  Typographic（排版）
 *  Visual（视觉）
                
>由于定位（positioning）可以从正常的文档流中移除元素，并且还能覆盖盒模型（box model）相关的样式，因此排在首位。盒模型排在第二位，因为它决定了组件的尺寸和位置。
其他属性只是影响组件的内部（inside）或者是不影响前两组属性，因此排在后面。

```css
.declaration-order {
  /* Positioning */
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  z-index: 100;
  /* Box-model */
  display: block;
  float: right;
  margin:	10px;
  padding: 10px;
  width: 100px;
  height: 100px;
  /* Typography */
  font: normal 13px "Helvetica Neue", sans-serif;
  line-height: 1.5;
  color: #333;
  text-align: center;
  /* Visual */
  background-color: #f5f5f5;
  border: 1px solid #e5e5e5;
  border-radius: 3px;
  /* Misc */
  opacity: 1;
}
```

## 2.3 不要使用 @import

- 与 &lt;link&gt; 标签相比，@import 指令要慢很多，不光增加了额外的请求次数，还会导致不可预料的问题。替代办法有以下几种：
- 使用多个 &lt;link&gt; 元素
- 通过 Sass 或 Less 类似的 CSS 预处理器将多个 CSS 文件编译为一个文件
- 通过 Rails、Jekyll 或其他系统中提供过 CSS 文件合并功能。

```css
<!-- Use link elements -->
<link rel="stylesheet" href="core.css">
<!-- Avoid @imports -->
<style>
  @import url("more.css");
</style>
```

## 2.4 媒体查询（Media query）的位置

- 媒体查询放在尽可能相关规则的附近。不要将他们打包放在一个单一样式文件中或者放在文档底部。如果你把他们分开了，将来只会被大家遗忘。下面给出一个典型的实例。

```css
.element { ... }
.element-avatar { ... }
.element-selected { ... }
@media (min-width: 480px) {
  .element { ...}
  .element-avatar { ... }
  .element-selected { ... }
}
```

## 2.5 带前缀的属性

- 通过当使用特定厂商的带有前缀的属性时，通过缩进的方式，让每个属性的值在垂直方向对齐，这样便于多行编辑。

```css
/* Prefixed properties */
.selector {
  -webkit-box-shadow: 0 1px 2px rgba(0,0,0,.15);
          box-shadow: 0 1px 2px rgba(0,0,0,.15);
}
```

## 2.6 单行规则声明

- 无论是一条声明的样式还是多条声明的样式，我们都应该在声明和括号之间进行换行，例如下面

```css
.span1 { 
    width: 60px; 
}
.span2 { 
    width: 140px; 
}
.span3 { 
    width: 220px; 
}

/* Multiple declarations, one per line */
.sprite {
  display: inline-block;
  width: 16px;
  height: 15px;
  background-image: url(../img/sprite.png);
}
.icon           {  
    background-position: 0 0; 
}
.icon-home      { 
    background-position: 0 -20px;
 }
.icon-account   { 
    background-position: 0 -40px;
 }
```

## 2.7 简写形式的属性声明

* 在需要显示地设置所有值的情况下，应当尽量限制使用简写形式的属性声明。常见的滥用简写属性声明的情况如下：
 * padding
 * margin
 * font
 * background
 * border
 * border-radius

>大部分情况下，我们不需要为简写形式的属性声明指定所有值。例如，HTML 的 heading 元素只需要设置上、下边距（margin）的值，因此，在必要的时候，只需覆盖这两个值就可以。过度使用简写形式的属性声明会导致代码混乱，并且会对属性值带来不必要的覆盖从而引起意外的副作用。

```css
/* Bad example */
.element {
  margin: 0 0 10px;
  background: red;
  background: url("image.jpg");
  border-radius: 3px 0 0 0;
}

/* Good example */
.element {
  margin-bottom: 10px;
  background-color: red;
  background-image: url("image.jpg");
  border-top-left-radius: 3px;
 }
```

## 2.8 Less 和 Sass 中的嵌套

- 避免非必要的嵌套。这是因为虽然你可以使用嵌套，但是并不意味着应该使用嵌套。只有在必须将样式限制在父元素内（也就是后代选择器），并且存在多个需要嵌套的元素时才使用嵌套。

```css
// Without nesting
.table > thead > tr > th { … }
.table > thead > tr > td { … }

// With nesting
.table > thead > tr {
  > th { … }
  > td { … }
}
```

## 2.9 注释

- 代码是由人编写并维护的。请确保你的代码能够自描述、注释良好并且易于他人理解。好的代码注释能够传达上下文关系和代码目的。不要简单地重申组件或 class 名称。对于较长的注释，务必书写完整的句子；对于一般性注解，可以书写简洁的短语。

```css
/* Bad example */
/* Modal header */
.modal-header {
  ...
}

/* Good example */
/* Wrapping element for .modal-title and .modal-close */
.modal-header {
  ...
}
```

## 2.10 编辑器配置

编辑器按照下面的配置进行设置，以避免常见的代码不一致和差异：

- 用四个空格代替制表符（soft-tab 即用空格代表 tab 符）。
- 保存文件时，删除尾部的空白符。
- 设置文件编码为 UTF-8。
- 在文件结尾添加一个空白行。

## 2.11 文件/资源命名

在 web 项目中，所有的文件名应该都遵循同一命名约定。以可读性而言，减号（-）是用来分隔文件名的不二之选。同时它也是常见的 URL 分隔符，所以理所当然的，减号应该也是用来分隔资源名称的好选择。

- 请确保文件命名总是以字母开头而不是数字。而以特殊字符开头命名的文件，一般都有特殊的含义与用处（比如 compass[1]中的下划线就是用来标记跳过直接编译的文件用的）。
- 资源的字母名称必须全为小写，这是因为在某些对大小写字母敏感的操作系统中，当文件通过工具压缩混淆后，或者人为修改过后，大小写不同而导致引用文件不同的错误，很难被发现。
- 还有一些情况下，需要对文件增加前后缀或特定的扩展名（比如 .min.js, .min.css），抑或一串前缀（比如3fa89b.main.min.css）。这种情况下，建议使用点分隔符来区分这些在文件名中带有清晰意义的元数据。

## 2.12 class 命名

- 通class 名称中只能出现小写字符和破折号（dashe）（不是下划线，也不是驼峰命名法）。破折号应当用于相关 class 的命名（类似于命名空间）（例如，.btn 和 .btn-danger）。
- 避免过度任意的简写。.btn 代表 button，但是 .s 不能表达任何意思。
- class 名称应当尽可能短，并且意义明确。
- 使用有意义的名称。使用有组织的或目的明确的名称，不要使用表现形式（presentational）的名称。
- 基于最近的父 class 或基本（base） class 作为新 class 的前缀。
- 使用 .js-\* class 来标识行为（与样式相对），并且不要将这些 class 包含到 CSS 文件中。
- 在为 Sass 和 Less 变量命名是也可以参考上面列出的各项规范。

```css
/* Bad example */
span { ... }
.page-container #stream .stream-item .tweet .tweet-header .username { ... }
.avatar { ... }

/* Good example */
.avatar { ... }
.tweet-header .username { ... }
.tweet .avatar { ... }
```

## 2.13 代码组织

- 以组件为单位组织代码段。
- 制定一致的注释规范。
- 使用一致的空白符将代码分隔成块，这样利于扫描较大的文档。
- 如果使用了多个 CSS 文件，将其按照组件而非页面的形式分拆，因为页面会被重组，而组件只会被移动。

```css
/*
 * Component section heading
 */
.fd-element { ... }
/*
 * Component section heading
 *
 * Sometimes you need to include optional context for the entire component. Do that up here if it's important enough.
 */
.fd-element { ... }
/* Contextual sub-component or modifer */
.fd-element-heading { ... }
```

## 2.14 命名规范

- 基本原则

        关注分离，将 HTML、CSS 解耦；模块化编码。

- 模块化编写实践

        语义化的模块名，通过模块名应该能一眼就看出模块的是干什么的。

```css
<dl class="fd-dl-01">
   <dt class="fd-dt-01">这是标题</dt>
   <dd class="fd-dd-01">这是内容</dd>
</dl>
```

> 上面的代码中，模块的名为 fd-dl-01，模块最外层使用 {命名空间}-{模块名} 的方式命名 Class。模块子元素以在此基础上进行命名。如果不继承父级的类名，很容易造成命名冲突。

- 充分考虑结构的语义化。

> 虽然在 Class 的命名上已经做到的了关注分离，编写样式不再依赖具体的元素名称，但仍应该考虑语义化，根据元素设计的目的来使用元素。是段落的，你就用 &lt;p&gt;；是标题的，就用 &lt;h1&gt;~&lt;h6&gt;；是引用的，就用 &lt;blockquote&gt;， 而不是简单粗暴的用 &lt;div&gt;、&lt;span&gt;。语义化的目的，一方面是抽去 CSS 以后，页面还是一个结构良好、可读的页面；另一方面，这也是 SEO 的最基本要求。避免不必要的 CSS 选择符嵌套。Class 已经模块化命名，从类名上已经可以清晰的分辨元素的从属，一般情况下也不会造成类名冲突，没有必要再进行选择器嵌套，保持 css 结构清晰，提高渲染效率。特殊情况可以嵌套（如提高权重、主题之间代码隔离），但应避免过多层级。

```css
/* 推荐写法 */
.fd-dl-01 {
    border: 1px solid #333;
}
.fd-dt-01  {
    margin: 0;
    padding: 5px 10px;
    border-bottom: 1px solid #333;
    background-color: #CCC;
}
.fd-dd-01  {
    margin: 10px;
}

/* 不推荐写法 */
.fd-dl-01 .fd-dt-01 {}
.fd-dl-01 .fd-dd-01 {}
```
> 与 JS 交互时，在模块 HTML 结构的最外一层添加状态，而非给模块每个子元素单独添加元素。给最外层添加状态类以后，整个模块的样式都能控制，减少操作，提高性能，比如，可以这样写：

```css
<dl class="fd-dl-01 fd-active">
   <dt class="fd-dt-01"></dt>
   <dd class="fd-dd-01"></dd>
</dl>

// 但不要这样写（效率更低）
<dl class="fd-dl-01 ">
   <dt class="fd-dt-01 fd-active "></dt>
   <dd class="fd-dd-01 fd-active "></dd>
</dl>
```

* 命名注意事项

 * 语义化，望文见义。如 fd-tab、fd-nav，不要使用 red、left 等表象的词命名。

 * 模块状态： {命名空间}-{模块名}-{状态描述}
 * 常用状态有：hover, current, selected, disabled, focus, blur, checked, success, error 等
 * 子模块： {命名空间}-{模块名}-{子模块名}
 * 常用模块名有：bd(body)，cnt(content)，hd(header)，text(txt)，img(images/pic)，title，item，cell 等，词义表达组件要实现的功能。

 * 模块嵌套：

```css
<ul class="fd-nav">
    <li class="fd-nav-item">
        <a href="#">nav Triggle Link</a>
        <ul class="fd-subnav">
            <li class="fd-subnav-item">
                <a href="#">subNav Triggle Link</a>
                    <ul class="fd-list">
```

> 统一命名风格（使用相同名词命名不同组件的子元素）：如 fd-tab-hd, fd-modal-hd，便于理解。

- CSS 编写注意事项

>不要添加浏览器厂商前缀，需要前缀引入prefixfree.js，或通过自动化工具添加。



# 三.Javascript

## 3.1 JavaScript 语言规范

### 3.1.1 文件编码

- 使用不带 BOM 的 UTF-8 编码。

### 3.1.2 使用严格模式

- 使用严格模式

```javascript
use strict
// code here
```

### 3.1.3 避免使用全局标量

- 避免使用全局变量，用模块化代替全局变量

### 3.1.4 语句的结尾总是使用分号

- 语句的结尾总是使用分号

```javascript
var foo = bar; // semicolon here.
var foo = function() {
    return true;
};  // semicolon here.

function foo() {
    return true;
}  // no semicolon here.
```

### 3.1.5 变量使用前必须使用var 声明

- 变量使用前必须使用 var 声明

### 3.1.6 块内函数声明

- 块内函数声明

>不要在块内声明一个函数（严格模式会报语法错误）。如果确实需要在块中定义函数，可以使用函数表达式来声明函数。

```javascript
/* Recommended */
if (x) {
    var foo = function() {};
}

/* Wrong */
if (x) {
    function foo() {}
}
```

### 3.1.7 异常

- 异常 ------ 可以使用，抛出错误，而不是字符串。

### 3.1.8 自定义异常

- 自定义异常 ------ 恰当的时候可以使用。

### 3.1.9 标准特性总是由于非标准特性

- 标准特性总是由于非标准特性

>优先使用原生的方法，而不是自行封装的非标准接口。

### 3.1.10 不要封装基本类型

- 不要封装基本类型，明确用于类型转换的场景除外。

```javascript
/* Recommended */
var x = Boolean(0);
if (x) {
    alert('hi');  // This will never be alerted.
}
typeof Boolean(0) == 'boolean';
typeof new Boolean(0) == 'object';

/* Not recommended */
var x = new Boolean(false);
if (x) {
    alert('hi');  // Shows 'hi'.
}
```

### 3.1.11 this

- this  ------ 仅在构造函数、方法、闭包中使用this关键字，以避免错误的引用的。

### 3.1.12 不要在 Array 上使用 for-in 循环

- 不要在 Array 上使用 for-in 循环

```javascript
/* Recommended */
var  obj={}
for(name in obj){
	//  do  something
}

/* wrong */
var  arr=[]
for(index in arr){
	//  do  something
}
```

### 3.1.13 不要使用关联数组

- 不要使用关联数组 ------ 需要键值对映射时直接使用Object。

### 3.1.14 用 Array 和 Object 字面量代替 Array 和 Object 构造函数

- 用 Array 和 Object 字面量代替 Array 和 Object 构造函数

```html
/* Recommend */
var arr = [x1, x2, x3],
    obj = {
        a: 0,
        b: 1,
        c: 2
    };

/* Not Recommend */
var arr = new Array(x1, x2),
    obj = new Object();
```

### 3.1.15 类方法的定义

- 类方法的定义

```javascript
/* Recommended */
var Foo = {
    // Foo object
};
Foo.prototype.bar = function() {
    // bar method
};

/* Not recommended */
var Foo = function() {
    this.bar = function() {
        // bar method
    };
};
```

### 3.1.16 禁止修改内置对象的原型

- 禁止修改内置对象的原型 ------ 如 Object.prototype、Array.prototype、Function.prototype 等。

### 3.1.17 闭包
- 闭包

>可以使用，但应该谨慎。有一点需要牢记，闭包保留了一个指向它封闭作用域的指针，所以，在给 DOM 元素附加闭包时，很可能会产生循环引用， 进一步导致内存泄漏。比如下面的代码：

```javascript
/* Wrong style */
function foo(element, a, b) {
    element.onclick = function() { /* uses a and b */ };
}
```
> 这里，即使没有使用element，闭包也保留了element、a和b的引用。由于element也保留了对闭包的引用，这就产生了循环引用，导致不能被GC 回收。可将代码重构为:

```javascript
function foo(element, a, b) {
    element.onclick = bar(a, b);
}

function bar(a, b) {
    return function() { /* uses a and b */ }
}
```

### 3.1.18 eval()

- eval() ------ 一般情况不要使用eval()，使用JSON.parse解析系列化字符串。

### 3.1.19不要使用 with() {}语句

- 不要使用 WITH() {}语句

### 3.1.19不要给 setInterval / setTimeOut 传递字符串

- 不要给 setInterval / setTimeOut 传递字符串

```javascript
/* recommended */
setTimout(function () {
   //do something 
},2000);

/* Not recommended */
setTimout("alter(5)",2000);
```

### 3.1.20拼接字符串

- 拼接字符串 ------ 一般情况使用 + 操作符拼接字符串。如果存在大量的字符串拼接，推荐采用数组 join() 拼接字符串。
- 不要使用多行字符串字面量。

```javascript
/* Recommended */
var myString = 'A rather long string of English text, an error message ' +
    'actually that just keeps going and going -- an error ' +
    'you\'ve got an error and all the extraneous whitespace is ' +
    'just gravy.  Have a nice day.';

/* Not recommended */
var myString = 'A rather long string of English text, an error\ message \
      actually that just keeps going and going -- an error \
      you\'ve got an error and all the extraneous whitespace is \
      just gravy.  Have a nice day.';
```

## 3.2 JavaScript 编码风格

### 3.2.1 命名方式

> 计算机科学只存在两个难题：缓存失效和命名——Phil Karton

- 命名仅限于数组和字母字符，也可以用下划线，最好不用用$和\。
- 常量
使用全大写字母，并用下划线分隔单词，形如

```javascript
var  MAX_CONNT=10;
var  URL='http://www.lol.com';
```
- 因浏览器支持问题，不要使用关键字。
- 变量

> 变量名采用小驼峰式命名，首字母小写，每个单词首字母大写，不要在变量中用下划线，名词不要用动词开头, 如：myName。

```javascript
var getBox="box";   //  错误，字符串是一个名词，不能动词开头	
	function set(name){
	   return name;	
	};	
var  myName= set("lol");
```

- 私有变量 ------ 私有属性、变量和方法以下划线_开头，形如_privateMethod。

- 函数
>命名采用小驼峰格式（构造函数大驼峰格式），避免同变量混淆，函数名第一个应该是动词，函数名字最好不要用下划线。

* 动词常见的约定:
 * can、has、js返回一个布尔值
 * get  返回一个非布尔值
 * set  用来保存一个值

```javascript
function doSomething(){
		    // todo
}
//  类名
function DoSomething(){	
		// todo
}
var  myFunction=new DoSomething();
```

- 文件名 ------ 全部使用小写字母并以.js结尾。

### 3.2.2 变量延迟初始化

1.允许延迟变量初始化，不必在声明变量时初始化。

2.字符串应该始终使用单引号,避免使用双引号。

```javascript
var   name="lol"; //不推荐
var   name='lol'; // 推荐
```
3.数字应该用十进制整数或者浮点，或者科学计数法，十六进制整数。

```javascript
	var  count=10 ;   //推荐
	var  count=10.0  ;   //推荐
	var  count=0xA2  ;   //推荐
	var  count=1e23  ;   //推荐
	var  count=10.0  ;   //推荐
```

4.避免使用null值，以下情况除外

* 用来初始化一个变量，这个变量可能被赋值为一个对象
* 用来和一个已经初始化的变量比较，这个变量可以是也可以不是一个对象
* 当函数的参数期望是一个对象时，被用做参数传入
* 当函数的返回值是一个对象时，被用作返回值传出

```javascript
var  person=null;
if(person!==null){
	// do something
}
```

5.避免使用undefined 值，除非要判断一个变量是否定义,typeof操作符、

```javascript
if(typeof person=='undefined'){
		// do something
	}
```

### 3.2.3 明确作用域

- 任何时候都要明确作用域，以提高可移植性和清晰度。例如，不要依赖作用域链中的window对象。

### 3.2.4 代码格式

- 缩进 ------ 4个空格，避免使用tab进行缩进

- 行的长度 ------ 每行的长度不该超过80个字符

- 运算符间距 ------ 二元运算符前后必有使用一个空格保持表达式的整洁，操作符包括赋值运算符和逻辑运算符

```javascript
var  found = (values[i] === item);
if (found && (count > 8)){
	//  do  something 
}；
for( var i = 0; i < values.length; i++){

}；
```

- 括号间距 ------ 当使用括号时，紧接左括号之后和紧接右括号不应该有空格

```javascript
if(found && (count > 10)){
		//  do something 
	}；
```

- 对象的直接量
 1. 起始左花括号应当和表达式保持一行
 2. 每个属性的名值对应当保持一个缩进，第一个属性应当在左括号后的另起一行
 3. 每个属性的名值对应当适应不含引号的属性名，其后紧跟一个冒号（之前不含空格），而后是值
 4. 倘若属性值是一个函数类型，函数体应当在属性名之下另起一行，而且其前后均应保留一个空行
 5. 一组相关的属性前后可以插入空行，以提升代码的可读性
 6. 结束的右括号应当独自占一行

```javascript
var  object={
	key1:"value1"，
	key2:function(){
		// do something			
	}，	
	key3:"value3"
 }；
```
- 注释 ------ 页面的注释永远都不会嫌多，请不要吝啬注释。
* 单行注释应当用来说明一行代码或者一组相关的代码。单行注释可能有三种使用方式
   1. 独占一行的注释，用来解释下一行的代码
   2. 在代码行的尾部的注释，用来解释它之前的代码
   3. 多行，用来注释掉一个代码块

* b.多行注释，每个多行注释至少有如下三点
 1. 首行仅仅包括/\* 注释开始。该行不应当有其他文字。
 2. 接下来的行以\* 开头保持左对齐，这些行可以有文字描述
 3. 最后一行以\*/ 开头并同先前的行保持对齐.

>注释主要是进行说明，例如：Todo：说明代码还未完成，应当包含下一步要做的事情;
Hack：为了兼容浏览器;Fixme：尽快修复; Xxx：说明代码有问题，应当尽快修复;      Review：说明任何代码改动都需要评审;

```javascript
	if（condition）{
		/*
		* 这里是注释
		*这是注释2
		*param  这里是注释三
		*/
	 };
```

### 3.2.5 花括号

- 始终添加花括号

```javascript
if (something) {
    // ...
} else {
    // ...
}
```

- 表示块起始的大括号，不能换行

```javascript
/\* Recommended \*/
if (something) {
    // ...
} else {
    // ...
}

/\* Not recommended \*/
if (something)
{
    // ...
}
else
{
    // ...
}
```

### 3.2.6 数组和对象的初始化

- 如果初始值不是很长，就保持写在单行上：

```javascript
var arr = [1, 2, 3];  // No space after [or before].
var obj = {a: 1, b: 2, c: 3};  // No space after { or before }.
```

- 初始值占用多行时，缩进 4 个空格。

- 比较长的标识符或者数值，不要为了让代码好看些而手工对齐。 如:

```javascript
/* Recommended */
CORRECT_Object.prototype = {
    a: 0,
    b: 1,
    lengthyName: 2
};

/* Not recommended */
WRONG_Object.prototype = {
    a          : 0,
    b          : 1,
    lengthyName: 2
};
```

### 3.2.7 函数参数

- 尽量让函数参数在同一行上。如果一行超过 80 字符，每个参数独占一行，并以 4 个空格缩进，或者与括号对齐，以提高可读性。尽可能不要让每行超过 80 个字符。比如：

```javascript
// Four-space, wrap at 80.  Works with very long function names, survives
// renaming without reindenting, low on space.
goog.foo.bar.doThingThatIsVeryDifficultToExplain = function(
    veryDescriptiveArgumentNumberOne, veryDescriptiveArgumentTwo,
    tableModelEventHandlerProxy, artichokeDescriptorAdapterIterator) {
  // ...
};

// Four-space, one argument per line.  Works with long function names,
// survives renaming, and emphasizes each argument.
goog.foo.bar.doThingThatIsVeryDifficultToExplain = function(
    veryDescriptiveArgumentNumberOne,
    veryDescriptiveArgumentTwo,
    tableModelEventHandlerProxy,
    artichokeDescriptorAdapterIterator) {
  // ...
};

// Parenthesis-aligned indentation, wrap at 80.  Visually groups arguments,
// low on space.
function foo(veryDescriptiveArgumentNumberOne, veryDescriptiveArgumentTwo,
             tableModelEventHandlerProxy, artichokeDescriptorAdapterIterator) {
  // ...
}

// Parenthesis-aligned, one argument per line.  Visually groups and
// emphasizes each individual argument.
function bar(veryDescriptiveArgumentNumberOne,
             veryDescriptiveArgumentTwo,
             tableModelEventHandlerProxy,
             artichokeDescriptorAdapterIterator) {
  // ...
}
```

### 3.2.8 空行

- 使用空行来划分一组逻辑上相关联的代码片段。文件末尾空一行。

### 3.2.9 二元和三元操作符

- 操作符始终写在前一行, 以免分号的隐式插入产生预想不到的问题。如果一行放不下, 还是按照上述的缩进风格来换行。

```javascript
var x = a ? b : c;  // All on one line if it will fit.

// Indentation +4 is OK.
var y = a ?
    longButSimpleOperandB : longButSimpleOperandC;

// Indenting to the line position of the first operand is also OK.
var z = a ?
        moreComplicatedB :
        moreComplicatedC;
```

### 3.2.10 空格

- 移除行末的空格；
- 调用函数的时候，函数名与左括号之间没有空格；
- 参数序列和圆括号之间，没有空格；
- 操作符之间空一格（就一格）；
- 所有其它语法元素和和圆括号之间，都有一个空格。


### 3.2.11 逗号位置

```javascript
/\* Recommended \*/
var a = 1,
    b = 3,
    c;

/\* Not Recommended \*/
var a = 1
    ,b
    ,c;
```

### 3.2.12 圆括号

- 圆括号在 JavaScript 中有两种作用，一种表示调用函数，一种表示不同的值的组合。只在必要的时候使用圆括号。

- 对于一元操作符（如 **delete、typeof、void** ），或是在某些关键词（如 **return、throw、case、new** ）之后，不要使用括号。

### 3.2.13 字符串

> 字符串使用 **单引号** ，只有 JSON 中的字符串属性值使用双引号。字符串中的 HTML 属性使用双引号。

```javascript
/* Recommended */
var string = 'this is a string',
    object = {
        str: "this is a JSON string"
    };

/* Not recommended */
var string = "this is a string",
    object = {
        str: 'this is a JSON string'
    };
```

### 3.2.14 对象

- 对象的最后一个属性值后面不要写逗号（某些浏览器会报错）。
