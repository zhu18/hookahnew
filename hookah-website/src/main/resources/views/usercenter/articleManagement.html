<%
var head = {
%>
<link rel="stylesheet" type="text/css" href="/static/css/user-center-menu.css">
<link rel="stylesheet" type="text/css" href="/static/css/usercenter-admin.css">
<%};%>

<%
var htmlPart = {
%>
<div class="user-center">
    <div class="user-center-bd y-row">
        <div class="user-center-menu y-left">
            <ul class="menu-list">
                <li class="menu-items active">
                    <h3 class="menu-header">用户中心</h3>
                    <ol class="menu-category active">
                        <li><a href="/usercenter">个人资料</a></li>
                        <li><a href="/usercenter/fundmanage">资金管理</a></li>
                        <li><a href="/usercenter/safeset">安全设置</a></li>
                    </ol>
                </li>
                <li class="menu-items">
                    <h3 class="menu-header">文章管理</h3>
                    <ol class="menu-category">
                        <li><a href="/usercenter/articleManagement">文章管理</a></li>
                    </ol>
                </li>
            </ul>

        </div>
        <div class="user-center-box y-right">
            <h3 class="center-title">文章管理</h3>
            <div class="article-management-box">
                <div class="select-title clearfix">
                    <label>文章分类：</label>
                    <select name="newsGroup" id="newsGroup" onchange="changes(this)">
                        <!--<option value="5">请选择分类</option>-->
                        <option value="innovation">双创中心</option>
                        <option value="exposition">博览会</option>
                        <option value="information">资讯中心</option>
                    </select>
                    <span class="select-line select-hide">-</span>
                    <select name="newsSonGroup" id="newsSonGroup" class="select-hide">
                        <option value="0">中心动态</option>
                        <option value="1">行业咨询</option>
                        <option value="2">中心公告</option>
                    </select>
                    <button  onclick="window.location='/usercenter/publishArticle'">发表文章</button>
                </div>
                <div class="article-box">
                    <table class="order-items">
                        <thead>
                            <tr class="order-head">
                                <th>序号</th>
                                <th>文章名称</th>
                                <th class="imgs">图片</th>
                                <th>创建日期</th>
                                <th>发表人</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                        <%
                        for( item in pageInfo.list){
                        %>
                            <tr>
                                <td>${print(itemLP.index)}</td>
                                <td>${item.newsTitle}</td>
                                <td class="imgs"><div><img src="${item.pictureUrl}"></div></td>
                                <td>${item.sytTime,"yyyy-MM-dd HH:mm:ss"}</td>
                                <%
                                if(item.sysUser == '' || item.sysUser == null ){
                                %>
                                <td>-</td>
                                <% }else{ %>
                                <td>${item.sysUser}</td>
                                <% } %>
                                <td>
                                    <a onclick="deleteData('${item.newsId}')">删除</a>
                                </td>
                            </tr>
                        <% } %>
                        </tbody>
                    </table>
                </div>
                <%include("/layout/pageaction.html"){} %>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    function changes(that){
        var thisVal = $(that).val();
        $('.select-hide').hide();
        if(thisVal == 'information'){
            $('#newsSonGroup').show();
            $('.select-line').show();
        }else{
            $('#newsSonGroup').hide();
            $('.select-line').hide();
        }
        if($(that).val() == 0){
            $(that).parents().siblings('.errors').show();
        }else{
            $(that).parents().siblings('.errors').hide();
        }
        var newsSonGroup = $('#newsSonGroup').val();
        var data = {};
        data.pageNumber = 1;
        data.pageSize = 8;
        data.newsGroup = thisVal;
        if(data.newsGroup == 'information'){
            data.newsSonGroup = newsSonGroup;
        };
        loadData(data);
    }
//    获取列表信息
    function loadData(data){
        $(".article-box > .order-items > tbody").html('');
        $.ajax({
            type: "get",
            url: "/sysNews/list",
            data: data,
            success: function(data){
                console.log(data);
                for(var i=0;i<data.list.length;i++){
                    $(".article-box > .order-items > tbody").append(
                       "<tr>"
                        +"<td>"+(i+1)+"</td>"
                        +"<td>"+data.list[i].newsTitle+"</td>"
                        +"<td class='imgs'>"+"<div>"+"<img src="+data.list[i].pictureUrl+">"+"</div>"+"</td>"
                        +"<td>"+format(data.list[i].sytTime)+"</td>"
                        +"<td>"+judge(data.list[i].sysUser)+"</td>"
                        +"<td>"
                        +"<a href='javascript:onclick=deleteData("+JSON.stringify(data.list[i].newsId)+");' >删除</a>"
                        +"<a href='/usercenter/publishArticle?id="+data.list[i].newsId+"'>修改</a>"
                        +"</td>"
                        +"</tr>"
                    );
                }
                function judge(user){
                    if(user == ""||user == null){
                        return "-";
                    }
                    return user;
                }
                function add(m){ return m < 10 ? '0'+ m:m };
                function format(time){
                    var date = new Date(time);
                    var year = date.getFullYear() ;
                    var month = date.getMonth()+1;
                    var date1 = date.getDate() ;
                    var hours = date.getHours();
                    var minutes = date.getMinutes();
                    var seconds = date.getSeconds();
                    return year+'-'+add(month)+'-'+add(date1)+' '+add(hours)+':'+add(minutes)+':'+add(seconds);
                };
            },
            error:function(e){
                alert(e);
            }
        });
    }
    function deleteData(id) {
        $.confirm('你确定要删除这条消息吗? ',null,function(type){
            if(type == 'yes'){
                deleteLoad(id);
                this.hide();
            }
        });
    }
    function deleteLoad(id){
        var arr=[];
        arr.push(id);
        $.ajax({
            type:"post",
            url:"/sysNews/deleteInfo",
            dataType: "json",
            data: JSON.stringify(arr),
            contentType: 'application/json',
            success:function(data){
                if(data.code == "1") {
                    $.alert('删除成功', true, function () {
//                        location.reload();
                    });
                }
            },
            error:function(e){
                alert(e);
            }
        });
    }

</script>
<%};
include("/layout/base.html",{headSection:head,htmlSection:htmlPart}){}
%>
