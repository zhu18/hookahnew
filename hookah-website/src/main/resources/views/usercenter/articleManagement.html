<%
var head = {
%>
<link rel="stylesheet" type="text/css" href="/static/css/user-center-menu.css">
<link rel="stylesheet" type="text/css" href="/static/css/usercenter-admin.css">
<%};%>

<%
var htmlPart = {
%>
<div class="user-center">
    <div class="user-center-bd y-row">
        <div class="user-center-menu y-left">
            <ul class="menu-list">
                <li class="menu-items active">
                    <h3 class="menu-header">用户中心</h3>
                    <ol class="menu-category active">
                        <li><a href="/usercenter">个人资料</a></li>
                        <li><a href="/usercenter/fundmanage">资金管理</a></li>
                        <li><a href="/usercenter/safeset">安全设置</a></li>
                    </ol>
                </li>
                <li class="menu-items">
                    <h3 class="menu-header">文章管理</h3>
                    <ol class="menu-category">
                        <li><a href="/usercenter/articleManagement">文章管理</a></li>
                        <li><a href="/usercenter/publishArticle">发表文章</a></li>
                    </ol>
                </li>
            </ul>

        </div>
        <div class="user-center-box y-right">
            <h3 class="center-title">文章管理</h3>
            <div class="article-management-box">
                <div class="select-title">
                    <label>文章分类：</label>
                    <select name="newsGroup" id="newsGroup" onchange="changes(this)">
                        <!--<option value="5">请选择分类</option>-->
                        <option value="innovation">双创中心</option>
                        <option value="exposition">博览会</option>
                        <option value="information">资讯中心</option>
                    </select>
                    <span class="select-line select-hide">-</span>
                    <select name="newsSonGroup" id="newsSonGroup" class="select-hide">
                        <option value="0">中心动态</option>
                        <option value="1">行业咨询</option>
                        <option value="2">中心公告</option>
                    </select>
                </div>
                <div class="article-box">
                    <table class="order-items">
                        <thead>
                            <tr class="order-head">
                                <th>序号</th>
                                <th>文章名称</th>
                                <th class="imgs">图片</th>
                                <th>创建日期</th>
                                <th>发表人</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <%include("/layout/pageaction.html"){} %>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    changes($("#newsGroup").val());
    function changes(that){
        var thisVal = $(that).val();
        $('.select-hide').hide();
        if(thisVal == 'information'){
            $('#newsSonGroup').show();
            $('.select-line').show();
        }else{
            $('#newsSonGroup').hide();
            $('.select-line').hide();
        }
        if($(that).val() == 0){
            $(that).parents().siblings('.errors').show();
        }else{
            $(that).parents().siblings('.errors').hide();
        }
        var newsSonGroup = $('#newsSonGroup').val();
        var data = {};
        data.pageNumber = 1;
        data.pageSize = 8;
        data.newsgroup = thisVal;
        if(data.newsgroup == 'information'){
            data.newsSonGroup = newsSonGroup;
        };

        loadData(data);
    }
    function loadData(data){
            $(".article-box > .order-items> tbody").html("");
        $.ajax({
            type: "get",
            url: "/sysNews/list",
            data: data,
            success: function(data){
                console.log(data);
                for(var i=0;i<data.list.length;i++){
                    $(".article-box>.order-items").append(
                        "<tr>"
                        +"<td>"+(i+1)+"</td>"
                        +"<td>"+data.list[i].newsTitle+"</td>"
                        +"<td class='imgs'>"+"<div>"+"<img src="+data.list[i].pictureUrl+">"+"</div>"+"</td>"
                        +"<td>"+getDate(data.list[i].sytTime)+"</td>"
                        +"<td>"+data.list[i].sysUser+"</td>"
                        +"<td>"
                        +"<span>删除</span>"
//                        +"<span onclick="+deleteData(data.list[i].newsId)+">删除</span>"
                        +"</td>"
                        +"</tr>"
                    );
                }
                function getDate(time){
                    var date = new Date(time);
                    year = date.getFullYear() + '年';
                    month = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '月';
                    date = date.getDate() + '日';
                    return year+month+date;
                }
            },
            error:function(e){
                err ? err(e):alert("请求或操作失败！");
            },

        });
    }

    function deleteData(id){
        $.ajax({
            type:"post",
            url:"/sysNews/deleteInfo",
            data:{newsId:id},
            success:function(data){
                if(data.code=="1"){
                    console.log("删除成功");
                }else {
                    $.alert(data.message);
                }
            }
        })
    }
</script>
<%};
include("/layout/base.html",{headSection:head,htmlSection:htmlPart}){}
%>
