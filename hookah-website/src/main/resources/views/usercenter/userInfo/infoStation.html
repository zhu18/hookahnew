<%
var head = {
%>
<link rel="stylesheet" href="/static/css/usercenter/userInfo/infoStation.css">
<script type="text/javascript">
	var pagePath = '/message/findByUserId';
	var pageType = 'get';
	var dataParm = {};
	dataParm.pageNumber = 1;
	dataParm.pageSize = 20;
    function loadPageData(data) {
        var ids = [];
        if (data.data.list.length > 0) {
            var list = data.data.list;
            var html = "";
            for (var i = 0; i < list.length; i++) {
                ids.push(list[i].id);
                var listStr = "'" + list[i].id + "'";
                html += '<tr>';
                html += '<td><input type="checkbox" name="items" value="' + list[i].id + '"></td>';
                if (list[i].isRead == '1') {
                    html += '<td class="text-align-left"><a href="javascript:void(0);" onclick="getInfo(this,' + listStr + ')">' + list[i].sendHeader + '</a></td>';
                } else {
                    html += '<td class="text-align-left isRead"><a href="javascript:void(0);" onclick="getInfo(this,' + listStr + ')">' + list[i].sendHeader + '</a></td>';
                }
                html += '<td>' + list[i].sendTime + '</td>';
                html += '<td>' + list[i].sendUserName + '</td>';
                html += '</tr>';
            }
            $(".order table tbody").html(html);
        } else {
            $(".list").html("<div class='listNone'>暂无信息</div>");
        }
        // 删除
        $("#delete").click(function () {
            var str = [];
            $("[name=items]:checkbox:checked").each(function () {
                str.push($(this).val());
            });
            if (str.length >= 1) {
                $.ajax({
                    url: "/message/delMessage",
                    type: 'post',
                    dataType: 'json',
                    data: JSON.stringify(str),
                    contentType: 'application/json',
                    success: function (data) {
                        if (data.code == 1) {
                            $.alert('删除成功', true, function () {
                                location.reload()
                            });
                        } else {
                            console.log("删除失败！");
                        }
                    }
                })
            } else {
                $.alert('至少选择一条消息')
            }
        });
        // 标记
        $("#flag").click(function () {
            var list = [];
            $("input[name='items']:checked").each(function () {
                $("input[name='items']:checked").parents("tr").css({"color": "#000"});
                list.push($(this).val());
            });
            $.ajax({
                url: "/message/markToReadMessage",
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify(list),
                success: function (data) {
                    if (data.code == 1) {
                        $.alert('标记成功', true, function () {
                            location.reload()
                        });
                    } else {
                        console.log("标记失败！");
                    }
                }
            })
        });
        $("[name='items']:checkbox").click(function () {
            var flag = true;
            var num = 0;
            $("[name='items']:checkbox").each(function () {
                if (!this.checked) {
                    flag = false;
                }else{
                    num+=1;
                }
            });
            $("[name='checkall']:checkbox").prop("checked", flag);
            if(num > 0){
                $('#flag').show();
            }else{
                $('#flag').hide();
            }
        });
    }
</script>
<%};%>
<%
var htmlPart = {
%>
<div class="grid-0 backgorund-gray">
	<div class="grid-row clearfix">
		<%include("/usercenter/user-center-menu.html"){} %>
		<div class="grid-left info-center-box ">
			<div class="header clearfix">
				<h4 class="grid-left info-center-title">我的消息</h4>
				<ul class="grid-left all">
					<li class="active">
						<a href="javascript:void(0);" class="active">全部消息
						<span id="infoOne"></span>
					</a>
					</li>
					<li class="active margin-left-20">
						<a href="/usercenter/unreadInfo">未读消息
						<span id="infoTwo"></span>
					</a>
					</li>
				</ul>
			</div>
			<div class="list">
				<div class="order">
					<table>
						<thead>
						<tr>
							<th class="check">
								<lable><input type="checkbox" class="checkall" name="checkall">&nbsp;全选</lable>
							</th>
							<th class="title text-align-left">标题</th>
							<th class="timer">时间</th>
							<th class="sender">发送人</th>
						</tr>
						</thead>
						<tbody>
						</tbody>
						<tfoot>
							<tr>
								<td>
									<lable><input type="checkbox" class="checkall" name="checkall">&nbsp;全选</lable>
								</td>
								<td class="text-align-left">
									<span id="delete" style="color:#247DE8;cursor: pointer">删除所选</span>
									<span id="flag" style="color:#247DE8; cursor: pointer;display:none;" class="margin-left-20">标记为已读</span>
								</td>
								<td></td>
								<td></td>
							</tr>
						</tfoot>
					</table>
				</div>
				<!--<div class="tableBot">-->
					<!--<lable><input type="checkbox" class="check-all">&nbsp;全选</lable>-->
					<!--<span id="delete">删除所有</span>-->
					<!--<span id="flag">标记为已读</span>-->
				<!--</div>-->
			</div>
			<%include("/layout/pageaction.html"){} %>
		</div>
	</div>
</div>
</div>
<%};
include("/layout/base.html",{headSection:head,htmlSection:htmlPart}){}
%>
<script type="text/javascript" src="/static/js/usercenter/userInfo/infoStation.js"></script>


